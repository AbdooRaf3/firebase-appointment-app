# دليل تشخيص مشاكل الإشعارات

## المشكلة الحالية:
التوست يظهر في المتصفح بشكل صحيح، ولكن الإشعارات لا تظهر على شاشة القفل.

## خطوات التشخيص:

### 1. فحص وحدة تحكم المتصفح
افتح وحدة تحكم المتصفح (F12) وابحث عن هذه الرسائل:

#### رسائل يجب أن تظهر:
```
✅ بدء إرسال إشعار للهاتف: {title: "موعد جديد", body: "..."}
✅ Service Worker registration: [object ServiceWorkerRegistration]
✅ إرسال بيانات الإشعار إلى Service Worker: {...}
✅ تم إرسال إشعار للهاتف بنجاح - محسن للآيفون
✅ رسالة من التطبيق الرئيسي: {...}
✅ عرض إشعار من التطبيق الرئيسي: ...
✅ تم عرض الإشعار بنجاح من التطبيق الرئيسي
```

#### رسائل خطأ محتملة:
```
❌ المتصفح لا يدعم Service Worker
❌ المتصفح لا يدعم الإشعارات
❌ لم يتم منح إذن الإشعارات: denied
❌ Service Worker غير نشط
❌ فشل في عرض الإشعار من التطبيق الرئيسي: ...
```

### 2. فحص إعدادات المتصفح

#### Chrome/Edge:
1. اضغط على 🔒 بجانب الرابط
2. تأكد من أن "الإشعارات" = "مسموح"
3. إذا كانت "محظور"، اضغط عليها واختر "مسموح"

#### Firefox:
1. اضغط على 🛡️ بجانب الرابط
2. تأكد من أن "الإشعارات" = "مسموح"

#### Safari (الآيفون):
1. اذهب إلى الإعدادات > Safari
2. تأكد من أن "الإشعارات" = "مفعل"

### 3. فحص Service Worker

#### في وحدة تحكم المتصفح:
```javascript
// فحص تسجيل Service Worker
navigator.serviceWorker.getRegistrations().then(registrations => {
  console.log('Service Workers:', registrations);
});

// فحص إذن الإشعارات
console.log('Notification permission:', Notification.permission);

// فحص دعم الإشعارات
console.log('Notification support:', 'Notification' in window);
```

### 4. اختبار الإشعارات

#### اختبار 1: إشعار تجريبي
1. اضغط على زر الإشعارات (🔔)
2. اضغط على "إرسال إشعار تجريبي"
3. تحقق من ظهور الإشعار في المتصفح

#### اختبار 2: اختبار شاشة القفل
1. اضغط على زر الإشعارات (🔔)
2. اضغط على "اختبار شاشة القفل"
3. تحقق من ظهور الإشعار على شاشة القفل

#### اختبار 3: إنشاء موعد جديد
1. اذهب إلى إنشاء موعد جديد
2. أنشئ موعد جديد
3. تحقق من ظهور الإشعار

### 5. حلول المشاكل الشائعة

#### المشكلة: "لم يتم منح إذن الإشعارات"
**الحل:**
1. اضغط على 🔒 بجانب الرابط
2. اختر "الإشعارات" = "مسموح"
3. أعد تحميل الصفحة

#### المشكلة: "Service Worker غير نشط"
**الحل:**
1. أعد تحميل الصفحة
2. تأكد من أن التطبيق يعمل على HTTPS
3. تحقق من تسجيل Service Worker

#### المشكلة: "المتصفح لا يدعم الإشعارات"
**الحل:**
1. استخدم متصفح حديث (Chrome, Firefox, Safari)
2. تأكد من تحديث المتصفح
3. جرب متصفح آخر

### 6. اختبار على أجهزة مختلفة

#### الكمبيوتر:
- ✅ Chrome/Edge: يعمل بشكل كامل
- ✅ Firefox: يعمل بشكل كامل
- ⚠️ Safari: قد يحتاج إعدادات إضافية

#### الهاتف:
- ✅ Android Chrome: يعمل بشكل كامل
- ✅ iPhone Safari: يعمل مع PWA
- ⚠️ iPhone Chrome: محدود

### 7. رسائل التشخيص المفيدة

#### في وحدة تحكم المتصفح:
```javascript
// فحص حالة الإشعارات
console.log('Notification permission:', Notification.permission);
console.log('Service Worker support:', 'serviceWorker' in navigator);
console.log('Push support:', 'PushManager' in window);

// فحص Service Workers
navigator.serviceWorker.getRegistrations().then(regs => {
  regs.forEach(reg => {
    console.log('SW scope:', reg.scope);
    console.log('SW state:', reg.active?.state);
  });
});
```

### 8. خطوات الحل السريع

1. **افتح وحدة تحكم المتصفح** (F12)
2. **ابحث عن رسائل الخطأ** في Console
3. **اضغط على زر الإشعارات** واختر "اختبار شاشة القفل"
4. **تحقق من رسائل التشخيص** في Console
5. **إذا لم تظهر رسائل، تحقق من إعدادات المتصفح**

### 9. معلومات إضافية

#### متطلبات الإشعارات:
- ✅ HTTPS (في الإنتاج)
- ✅ إذن الإشعارات
- ✅ Service Worker نشط
- ✅ دعم المتصفح للإشعارات

#### إعدادات الآيفون:
- ✅ إضافة إلى الشاشة الرئيسية
- ✅ إذن الإشعارات في Safari
- ✅ iOS 16.4+ للإشعارات الكاملة

## إذا استمرت المشكلة:

1. **انسخ رسائل وحدة التحكم** وأرسلها
2. **اذكر نوع المتصفح والإصدار**
3. **اذكر نوع الجهاز (كمبيوتر/هاتف)**
4. **اذكر نظام التشغيل**
